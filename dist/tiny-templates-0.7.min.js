function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).TinyTemplate=e()}}(function(){var define,module,exports;return function(){return function e(t,n,o){function s(a,l){if(!n[a]){if(!t[a]){var r="function"==typeof require&&require;if(!l&&r)return r(a,!0);if(i)return i(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){return s(t[a][1][e]||e)},u,u.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)s(o[a]);return s}}()({1:[function(e,t,n){var o,s;o=this,s=function(){"use strict";var e,t=!1,n=function(e){if(e){var t,n=Object.keys(e),o=n.length;for(t=0;t<o;t++)this[n[t]]=e[n[t]]}};n.prototype={toString:function(){return JSON.stringify(this)},setValue:function(e,t){return this[e]=t,this}};var o=function(e){var t=[];return"#text"!==e.nodeName&&"#comment"!==e.nodeName&&(t.push(e.nodeName),e.attributes&&(e.attributes.class&&t.push(e.nodeName+"."+e.attributes.class.replace(/ /g,".")),e.attributes.id&&t.push(e.nodeName+"#"+e.attributes.id))),t},s=function(e){var t,n,s,i,a,l,r,d={},u={},c=e.length;for(l=0;l<c;l++)for(t=(n=e[l]).length,s=o(n),r=0;r<t;r++)(a=(i=s[r])in d)||i in u?a&&(delete d[i],u[i]=!0):d[i]=!0;return d},i=function(e,t){var n,o,i=s(e),a=s(t),l={},r=Object.keys(i),d=r.length;for(o=0;o<d;o++)a[n=r[o]]&&(l[n]=!0);return l},a=function(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,!e.childNodes||e.childNodes.every(a)},l=function(e,t){var n,o;if(!["nodeName","value","checked","selected","data"].every(function(n){return e[n]===t[n]}))return!1;if(Boolean(e.attributes)!==Boolean(t.attributes))return!1;if(Boolean(e.childNodes)!==Boolean(t.childNodes))return!1;if(e.attributes){if(n=Object.keys(e.attributes),o=Object.keys(t.attributes),n.length!==o.length)return!1;if(!n.every(function(n){return e.attributes[n]===t.attributes[n]}))return!1}if(e.childNodes){if(e.childNodes.length!==t.childNodes.length)return!1;if(!e.childNodes.every(function(e,n){return l(e,t.childNodes[n])}))return!1}return!0},r=function(e,t,n,o,s){var a,l,d;if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return!!s||e.data===t.data;if(e.nodeName in n)return!0;if(e.attributes&&t.attributes){if(e.attributes.id){if(e.attributes.id!==t.attributes.id)return!1;if(e.nodeName+"#"+e.attributes.id in n)return!0}if(e.attributes.class&&e.attributes.class===t.attributes.class)if(e.nodeName+"."+e.attributes.class.replace(/ /g,".")in n)return!0}return!!o||(l=e.childNodes?e.childNodes.slice().reverse():[],d=t.childNodes?t.childNodes.slice().reverse():[],l.length===d.length&&(s?l.every(function(e,t){return e.nodeName===d[t].nodeName}):(a=i(l,d),l.every(function(e,t){return r(e,d[t],a,!0,!0)}))))},d=function(e){return JSON.parse(JSON.stringify(e))},u=function(e,t,n,s){var a,l,d,u,c=0,h=[],f=e.length,m=t.length,p=Array.apply(null,new Array(f+1)).map(function(){return[]}),_=i(e,t),V=f===m;for(V&&e.some(function(e,n){var s=o(e),i=o(t[n]);return s.length!==i.length?(V=!1,!0):(s.some(function(e,t){if(e!==i[t])return V=!1,!0}),!V||void 0)}),a=0;a<f;a++)for(d=e[a],l=0;l<m;l++)u=t[l],n[a]||s[l]||!r(d,u,_,V)?p[a+1][l+1]=0:(p[a+1][l+1]=p[a][l]?p[a][l]+1:1,p[a+1][l+1]>=c&&(c=p[a+1][l+1],h=[a+1,l+1]));return 0!==c&&{oldValue:h[0]-c,newValue:h[1]-c,length:c}},c=function(e,t){return Array.apply(null,new Array(e)).map(function(){return t})};function h(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}var f=function(){this.list=[]};f.prototype={list:!1,add:function(e){this.list.push.apply(this.list,e)},forEach:function(e){var t,n=this.list.length;for(t=0;t<n;t++)e(this.list[t])}};var m=function(e){var t,n,o={debug:!1,diffcap:10,maxDepth:!1,maxChildCount:50,maxChildDiffCount:3,valueDiffing:!0,textDiff:function(){arguments[0].data=arguments[3]},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null,compress:!1};for(t in void 0===e&&(e={}),o)void 0===e[t]?this[t]=o[t]:this[t]=e[t];var s={addAttribute:"addAttribute",modifyAttribute:"modifyAttribute",removeAttribute:"removeAttribute",modifyTextElement:"modifyTextElement",relocateGroup:"relocateGroup",removeElement:"removeElement",addElement:"addElement",removeTextElement:"removeTextElement",addTextElement:"addTextElement",replaceElement:"replaceElement",modifyValue:"modifyValue",modifyChecked:"modifyChecked",modifySelected:"modifySelected",modifyComment:"modifyComment",action:"action",route:"route",oldValue:"oldValue",newValue:"newValue",element:"element",group:"group",from:"from",to:"to",name:"name",value:"value",data:"data",attributes:"attributes",nodeName:"nodeName",childNodes:"childNodes",checked:"checked",selected:"selected"};if(this.compress)for(t in n=0,this._const={},s)this._const[t]=n,n++;else this._const=s};return m.Diff=n,m.prototype={diff:function(t,n){var o=this.nodeToObj(t),s=this.nodeToObj(n);return e=0,this.debug&&(this.t1Orig=this.nodeToObj(t),this.t2Orig=this.nodeToObj(n)),this.tracker=new f,this.findDiffs(o,s)},findDiffs:function(n,o){var s;do{if(this.debug&&(e+=1)>this.diffcap)throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig));0===(s=this.findNextDiff(n,o,[])).length&&(l(n,o)||(t?(console.error("Could not find remaining diffs!"),console.log({t1:n,t2:o})):(t=!0,a(n),s=this.findNextDiff(n,o,[])))),s.length>0&&(t=!1,this.tracker.add(s),this.applyVirtual(n,s))}while(s.length>0);return this.tracker.list},findNextDiff:function(e,t,n){var o,s;if(this.maxDepth&&n.length>this.maxDepth)return[];if(!e.outerDone){if(o=this.findOuterDiff(e,t,n),this.filterOuterDiff&&(s=this.filterOuterDiff(e,t,o))&&(o=s),o.length>0)return e.outerDone=!0,o;e.outerDone=!0}if(!e.innerDone){if((o=this.findInnerDiff(e,t,n)).length>0)return o;e.innerDone=!0}if(this.valueDiffing&&!e.valueDone){if((o=this.findValueDiff(e,t,n)).length>0)return e.valueDone=!0,o;e.valueDone=!0}return[]},findOuterDiff:function(e,t,o){var s,i,a,r,u,c,h=this,f=[];if(e.nodeName!==t.nodeName)return[(new n).setValue(h._const.action,h._const.replaceElement).setValue(h._const.oldValue,d(e)).setValue(h._const.newValue,d(t)).setValue(h._const.route,o)];if(o.length&&this.maxChildCount&&e.childNodes&&t.childNodes&&e.childNodes.length>this.maxChildCount&&t.childNodes.length>this.maxChildCount){for(var m=e.childNodes.length<t.childNodes.length?e.childNodes.length:t.childNodes.length,p=0,_=0;p<this.maxChildDiffCount&&_<m;)l(e.childNodes[_],t.childNodes[_])||p++,_++;if(p===this.maxChildDiffCount)return[(new n).setValue(h._const.action,h._const.replaceElement).setValue(h._const.oldValue,d(e)).setValue(h._const.newValue,d(t)).setValue(h._const.route,o)]}if(e.data!==t.data)return"#text"===e.nodeName?[(new n).setValue(h._const.action,h._const.modifyTextElement).setValue(h._const.route,o).setValue(h._const.oldValue,e.data).setValue(h._const.newValue,t.data)]:[(new n).setValue(h._const.action,h._const.modifyComment).setValue(h._const.route,o).setValue(h._const.oldValue,e.data).setValue(h._const.newValue,t.data)];for(i=e.attributes?Object.keys(e.attributes).sort():[],a=t.attributes?Object.keys(t.attributes).sort():[],r=i.length,c=0;c<r;c++)s=i[c],-1===(u=a.indexOf(s))?f.push((new n).setValue(h._const.action,h._const.removeAttribute).setValue(h._const.route,o).setValue(h._const.name,s).setValue(h._const.value,e.attributes[s])):(a.splice(u,1),e.attributes[s]!==t.attributes[s]&&f.push((new n).setValue(h._const.action,h._const.modifyAttribute).setValue(h._const.route,o).setValue(h._const.name,s).setValue(h._const.oldValue,e.attributes[s]).setValue(h._const.newValue,t.attributes[s])));for(r=a.length,c=0;c<r;c++)s=a[c],f.push((new n).setValue(h._const.action,h._const.addAttribute).setValue(h._const.route,o).setValue(h._const.name,s).setValue(h._const.value,t.attributes[s]));return f},nodeToObj:function(e){var t,n,o,s,i,a={};if(a.nodeName=e.nodeName,"#text"===a.nodeName||"#comment"===a.nodeName)a.data=e.data;else{if(e.attributes&&e.attributes.length>0)for(a.attributes={},o=(t=Array.prototype.slice.call(e.attributes)).length,i=0;i<o;i++)s=t[i],a.attributes[s.name]=s.value;if("TEXTAREA"===a.nodeName)a.value=e.value;else if(e.childNodes&&e.childNodes.length>0)for(a.childNodes=[],o=(t=Array.prototype.slice.call(e.childNodes)).length,i=0;i<o;i++)n=t[i],a.childNodes.push(this.nodeToObj(n));this.valueDiffing&&(void 0!==e.checked&&e.type&&-1!==["radio","checkbox"].indexOf(e.type.toLowerCase())?a.checked=e.checked:void 0!==e.value&&(a.value=e.value),void 0!==e.selected&&(a.selected=e.selected))}return a},objToNode:function(e,t){var n,o,s,i,a,l,r;if("#text"===e.nodeName)n=document.createTextNode(e.data);else if("#comment"===e.nodeName)n=document.createComment(e.data);else{if("svg"===e.nodeName||t?(n=document.createElementNS("http://www.w3.org/2000/svg",e.nodeName),t=!0):n=document.createElement(e.nodeName),e.attributes)for(l=(s=Object.keys(e.attributes)).length,r=0;r<l;r++)o=s[r],n.setAttribute(o,e.attributes[o]);if(e.childNodes)for(l=(a=e.childNodes).length,r=0;r<l;r++)i=a[r],n.appendChild(this.objToNode(i,t));this.valueDiffing&&(e.value&&(n.value=e.value),e.checked&&(n.checked=e.checked),e.selected&&(n.selected=e.selected))}return n},findInnerDiff:function(e,t,o){e.subsets;var s,i,a,l,r,h=e.subsets&&e.subsetsAge--?e.subsets:e.childNodes&&t.childNodes?function(e,t){for(var n,o,s,i=e.childNodes?e.childNodes:[],a=t.childNodes?t.childNodes:[],l=c(i.length,!1),r=c(a.length,!1),d=[],h=!0,f=function(){return arguments[1]},m=function(e){l[h.oldValue+e]=!0,r[h.newValue+e]=!0};h;)if(h=u(i,a,l,r))for(d.push(h),n=(o=Array.apply(null,new Array(h.length)).map(f)).length,s=0;s<n;s++)m(o[s]);return e.subsets=d,e.subsetsAge=100,d}(e,t):[],f=e.childNodes?e.childNodes:[],m=t.childNodes?t.childNodes:[],p=[],_=0,V=this;if(h.length>0&&(p=this.attemptGroupRelocation(e,t,h,o)).length>0)return p;for(i=Math.max(f.length,m.length),f.length!==m.length&&(s=!0),r=0;r<i;r+=1)a=f[r],l=m[r],s&&(a&&!l?"#text"===a.nodeName?(p.push((new n).setValue(V._const.action,V._const.removeTextElement).setValue(V._const.route,o.concat(_)).setValue(V._const.value,a.data)),_-=1):(p.push((new n).setValue(V._const.action,V._const.removeElement).setValue(V._const.route,o.concat(_)).setValue(V._const.element,d(a))),_-=1):l&&!a&&("#text"===l.nodeName?p.push((new n).setValue(V._const.action,V._const.addTextElement).setValue(V._const.route,o.concat(_)).setValue(V._const.value,l.data)):p.push((new n).setValue(V._const.action,V._const.addElement).setValue(V._const.route,o.concat(_)).setValue(V._const.element,d(l))))),a&&l&&(p=p.concat(this.findNextDiff(a,l,o.concat(_)))),_+=1;return e.innerDone=!0,p},attemptGroupRelocation:function(e,t,o,s){var i,a,l,u,h,f,m,p,_,V=this,g=function(e,t,n){var o,s,i,a,l,r=e.childNodes?c(e.childNodes.length,!0):[],d=t.childNodes?c(t.childNodes.length,!0):[],u=0,h=n.length;for(o=0;o<h;o++){for(i=(l=n[o]).oldValue+l.length,a=l.newValue+l.length,s=l.oldValue;s<i;s+=1)r[s]=u;for(s=l.newValue;s<a;s+=1)d[s]=u;u+=1}return{gaps1:r,gaps2:d}}(e,t,o),N=g.gaps1,v=g.gaps2,b=Math.min(N.length,v.length),w=[];for(p=0,m=0;p<b;m+=1,p+=1)if(!0===N[p])if("#text"===(u=e.childNodes[m]).nodeName){if("#text"===t.childNodes[p].nodeName&&u.data!==t.childNodes[p].data){for(f=m;e.childNodes.length>f+1&&"#text"===e.childNodes[f+1].nodeName;)if(f+=1,t.childNodes[p].data===e.childNodes[f].data){h=!0;break}if(!h)return w.push((new n).setValue(V._const.action,V._const.modifyTextElement).setValue(V._const.route,s.concat(p)).setValue(V._const.oldValue,u.data).setValue(V._const.newValue,t.childNodes[p].data)),w}w.push((new n).setValue(V._const.action,V._const.removeTextElement).setValue(V._const.route,s.concat(p)).setValue(V._const.value,u.data)),N.splice(p,1),b=Math.min(N.length,v.length),p-=1}else w.push((new n).setValue(V._const.action,V._const.removeElement).setValue(V._const.route,s.concat(p)).setValue(V._const.element,d(u))),N.splice(p,1),b=Math.min(N.length,v.length),p-=1;else if(!0===v[p])"#text"===(u=t.childNodes[p]).nodeName?(w.push((new n).setValue(V._const.action,V._const.addTextElement).setValue(V._const.route,s.concat(p)).setValue(V._const.value,u.data)),N.splice(p,0,!0),b=Math.min(N.length,v.length),m-=1):(w.push((new n).setValue(V._const.action,V._const.addElement).setValue(V._const.route,s.concat(p)).setValue(V._const.element,d(u))),N.splice(p,0,!0),b=Math.min(N.length,v.length),m-=1);else if(N[p]!==v[p]){if(w.length>0)return w;if(l=o[N[p]],(a=Math.min(l.newValue,e.childNodes.length-l.length))!==l.oldValue){for(i=!1,_=0;_<l.length;_+=1)r(e.childNodes[a+_],e.childNodes[l.oldValue+_],[],!1,!0)||(i=!0);if(i)return[(new n).setValue(V._const.action,V._const.relocateGroup).setValue("groupLength",l.length).setValue(V._const.from,l.oldValue).setValue(V._const.to,a).setValue(V._const.route,s)]}}return w},findValueDiff:function(e,t,o){var s=[],i=this;return e.selected!==t.selected&&s.push((new n).setValue(i._const.action,i._const.modifySelected).setValue(i._const.oldValue,e.selected).setValue(i._const.newValue,t.selected).setValue(i._const.route,o)),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&s.push((new n).setValue(i._const.action,i._const.modifyValue).setValue(i._const.oldValue,e.value).setValue(i._const.newValue,t.value).setValue(i._const.route,o)),e.checked!==t.checked&&s.push((new n).setValue(i._const.action,i._const.modifyChecked).setValue(i._const.oldValue,e.checked).setValue(i._const.newValue,t.checked).setValue(i._const.route,o)),s},applyVirtual:function(e,t){var n,o,s=t.length;if(0===s)return!0;for(o=0;o<s;o++)n=t[o],this.applyVirtualDiff(e,n);return!0},getFromVirtualRoute:function(e,t){var n,o,s=e;for(t=t.slice();t.length>0;){if(!s.childNodes)return!1;o=t.splice(0,1)[0],n=s,s=s.childNodes[o]}return{node:s,parentNode:n,nodeIndex:o}},applyVirtualDiff:function(e,t){var n,o,s,i,a,l,r,u,c=this.getFromVirtualRoute(e,t[this._const.route]),h=c.node,f=c.parentNode,m=c.nodeIndex,p=[],_=this,V={diff:t,node:h};if(this.preVirtualDiffApply(V))return!0;switch(t[this._const.action]){case this._const.addAttribute:h.attributes||(h.attributes={}),h.attributes[t[this._const.name]]=t[this._const.value],"checked"===t[this._const.name]?h.checked=!0:"selected"===t[this._const.name]?h.selected=!0:"INPUT"===h.nodeName&&"value"===t[this._const.name]&&(h.value=t[this._const.value]);break;case this._const.modifyAttribute:h.attributes[t[this._const.name]]=t[this._const.newValue],"INPUT"===h.nodeName&&"value"===t[this._const.name]&&(h.value=t[this._const.value]);break;case this._const.removeAttribute:delete h.attributes[t[this._const.name]],0===Object.keys(h.attributes).length&&delete h.attributes,"checked"===t[this._const.name]?h.checked=!1:"selected"===t[this._const.name]?delete h.selected:"INPUT"===h.nodeName&&"value"===t[this._const.name]&&delete h.value;break;case this._const.modifyTextElement:h.data=t[this._const.newValue];break;case this._const.modifyValue:h.value=t[this._const.newValue];break;case this._const.modifyComment:h.data=t[this._const.newValue];break;case this._const.modifyChecked:h.checked=t[this._const.newValue];break;case this._const.modifySelected:h.selected=t[this._const.newValue];break;case this._const.replaceElement:(o=d(t[this._const.newValue])).outerDone=!0,o.innerDone=!0,o.valueDone=!0,f.childNodes[m]=o;break;case this._const.relocateGroup:for(l=(i=h.childNodes.splice(t[this._const.from],t.groupLength).reverse()).length,u=0;u<l;u++)s=i[u],h.childNodes.splice(t[_._const.to],0,s);h.subsets&&h.subsets.forEach(function(e){t[_._const.from]<t[_._const.to]&&e.oldValue<=t[_._const.to]&&e.oldValue>t[_._const.from]?(e.oldValue-=t.groupLength,(n=e.oldValue+e.length-t[_._const.to])>0&&(p.push({oldValue:t[_._const.to]+t.groupLength,newValue:e.newValue+e.length-n,length:n}),e.length-=n)):t[_._const.from]>t[_._const.to]&&e.oldValue>t[_._const.to]&&e.oldValue<t[_._const.from]?(e.oldValue+=t.groupLength,(n=e.oldValue+e.length-t[_._const.to])>0&&(p.push({oldValue:t[_._const.to]+t.groupLength,newValue:e.newValue+e.length-n,length:n}),e.length-=n)):e.oldValue===t[_._const.from]&&(e.oldValue=t[_._const.to])});break;case this._const.removeElement:f.childNodes.splice(m,1),f.subsets&&f.subsets.forEach(function(e){e.oldValue>m?e.oldValue-=1:e.oldValue===m?e.delete=!0:e.oldValue<m&&e.oldValue+e.length>m&&(e.oldValue+e.length-1===m?e.length--:(p.push({newValue:e.newValue+m-e.oldValue,oldValue:m,length:e.length-m+e.oldValue-1}),e.length=m-e.oldValue))}),h=f;break;case this._const.addElement:a=t[this._const.route].slice(),r=a.splice(a.length-1,1)[0],h=this.getFromVirtualRoute(e,a).node,(o=d(t[this._const.element])).outerDone=!0,o.innerDone=!0,o.valueDone=!0,h.childNodes||(h.childNodes=[]),r>=h.childNodes.length?h.childNodes.push(o):h.childNodes.splice(r,0,o),h.subsets&&h.subsets.forEach(function(e){e.oldValue>=r?e.oldValue+=1:e.oldValue<r&&e.oldValue+e.length>r&&(n=e.oldValue+e.length-r,p.push({newValue:e.newValue+e.length-n,oldValue:r+1,length:n}),e.length-=n)});break;case this._const.removeTextElement:f.childNodes.splice(m,1),"TEXTAREA"===f.nodeName&&delete f.value,f.subsets&&f.subsets.forEach(function(e){e.oldValue>m?e.oldValue-=1:e.oldValue===m?e.delete=!0:e.oldValue<m&&e.oldValue+e.length>m&&(e.oldValue+e.length-1===m?e.length--:(p.push({newValue:e.newValue+m-e.oldValue,oldValue:m,length:e.length-m+e.oldValue-1}),e.length=m-e.oldValue))}),h=f;break;case this._const.addTextElement:a=t[this._const.route].slice(),r=a.splice(a.length-1,1)[0],(o={}).nodeName="#text",o.data=t[this._const.value],(h=this.getFromVirtualRoute(e,a).node).childNodes||(h.childNodes=[]),r>=h.childNodes.length?h.childNodes.push(o):h.childNodes.splice(r,0,o),"TEXTAREA"===h.nodeName&&(h.value=t[this._const.newValue]),h.subsets&&h.subsets.forEach(function(e){e.oldValue>=r&&(e.oldValue+=1),e.oldValue<r&&e.oldValue+e.length>r&&(n=e.oldValue+e.length-r,p.push({newValue:e.newValue+e.length-n,oldValue:r+1,length:n}),e.length-=n)});break;default:console.log("unknown action")}h.subsets&&(h.subsets=h.subsets.filter(function(e){return!e.delete&&e.oldValue!==e.newValue}),p.length&&(h.subsets=h.subsets.concat(p))),V.newNode=o,this.postVirtualDiffApply(V)},apply:function(e,t){var n,o,s=t.length;if(0===s)return!0;for(o=0;o<s;o++)if(n=t[o],!this.applyDiff(e,n))return!1;return!0},getFromRoute:function(e,t){t=t.slice();for(var n,o=e;t.length>0;){if(!o.childNodes)return!1;n=t.splice(0,1)[0],o=o.childNodes[n]}return o},applyDiff:function(e,t){var n,o,s,i,a,l,r,d,u=this.getFromRoute(e,t[this._const.route]),c=this,h={diff:t,node:u};if(this.preDiffApply(h))return!0;switch(t[this._const.action]){case this._const.addAttribute:if(!u||!u.setAttribute)return!1;u.setAttribute(t[this._const.name],t[this._const.value]);break;case this._const.modifyAttribute:if(!u||!u.setAttribute)return!1;u.setAttribute(t[this._const.name],t[this._const.newValue]);break;case this._const.removeAttribute:if(!u||!u.removeAttribute)return!1;u.removeAttribute(t[this._const.name]);break;case this._const.modifyTextElement:if(!u||3!==u.nodeType)return!1;this.textDiff(u,u.data,t[this._const.oldValue],t[this._const.newValue]);break;case this._const.modifyValue:if(!u||void 0===u.value)return!1;u.value=t[this._const.newValue];break;case this._const.modifyComment:if(!u||void 0===u.data)return!1;this.textDiff(u,u.data,t[this._const.oldValue],t[this._const.newValue]);break;case this._const.modifyChecked:if(!u||void 0===u.checked)return!1;u.checked=t[this._const.newValue];break;case this._const.modifySelected:if(!u||void 0===u.selected)return!1;u.selected=t[this._const.newValue];break;case this._const.replaceElement:u.parentNode.replaceChild(this.objToNode(t[this._const.newValue],"http://www.w3.org/2000/svg"===u.namespaceURI),u);break;case this._const.relocateGroup:for(a=(i=Array.apply(null,new Array(t.groupLength)).map(function(){return u.removeChild(u.childNodes[t[c._const.from]])})).length,r=0;r<a;r++)l=i[r],0===r&&(o=u.childNodes[t[c._const.to]]),u.insertBefore(l,o||null);break;case this._const.removeElement:u.parentNode.removeChild(u);break;case this._const.addElement:d=(s=t[this._const.route].slice()).splice(s.length-1,1)[0],(u=this.getFromRoute(e,s)).insertBefore(this.objToNode(t[this._const.element],"http://www.w3.org/2000/svg"===u.namespaceURI),u.childNodes[d]||null);break;case this._const.removeTextElement:if(!u||3!==u.nodeType)return!1;u.parentNode.removeChild(u);break;case this._const.addTextElement:if(d=(s=t[this._const.route].slice()).splice(s.length-1,1)[0],n=document.createTextNode(t[this._const.value]),!(u=this.getFromRoute(e,s))||!u.childNodes)return!1;u.insertBefore(n,u.childNodes[d]||null);break;default:console.log("unknown action")}return h.newNode=n,this.postDiffApply(h),!0},undo:function(e,t){var n,o,s=t.length;for(t=t.slice(),s||(t=[t]),t.reverse(),o=0;o<s;o++)n=t[o],this.undoDiff(e,n)},undoDiff:function(e,t){switch(t[this._const.action]){case this._const.addAttribute:t[this._const.action]=this._const.removeAttribute,this.applyDiff(e,t);break;case this._const.modifyAttribute:h(t,this._const.oldValue,this._const.newValue),this.applyDiff(e,t);break;case this._const.removeAttribute:t[this._const.action]=this._const.addAttribute,this.applyDiff(e,t);break;case this._const.modifyTextElement:case this._const.modifyValue:case this._const.modifyComment:case this._const.modifyChecked:case this._const.modifySelected:case this._const.replaceElement:h(t,this._const.oldValue,this._const.newValue),this.applyDiff(e,t);break;case this._const.relocateGroup:h(t,this._const.from,this._const.to),this.applyDiff(e,t);break;case this._const.removeElement:t[this._const.action]=this._const.addElement,this.applyDiff(e,t);break;case this._const.addElement:t[this._const.action]=this._const.removeElement,this.applyDiff(e,t);break;case this._const.removeTextElement:t[this._const.action]=this._const.addTextElement,this.applyDiff(e,t);break;case this._const.addTextElement:t[this._const.action]=this._const.removeTextElement,this.applyDiff(e,t);break;default:console.log("unknown action")}}},m},void 0!==n?void 0!==t&&t.exports?n=t.exports=s():n.diffDOM=s():"function"==typeof define?define(s):o.diffDOM=s()},{}],2:[function(require,module,exports){"use strict";const diffDom=require("diff-dom");module.exports=class TinyTemplate{constructor(e,t,n,o){this._name=e,this._stringView=o,this._activeNodes=null,this._state=t,this._methods=n,this._rootNode=null;for(let e in this._methods)this._methods.hasOwnProperty(e)&&(this._methods[e]=this._methods[e].bind(this))}mount(e){this._rootNode=e,this.updateView()}methods(){return this._methods}changeState(newState){"string"==typeof newState&&(newState=eval("("+newState+")"));let hasChanged=!1;for(let e in newState)hasChanged=!0,this._state[e]=newState[e];hasChanged&&this.updateView()}getState(e){return this._state[e]}parseView(maxIterations=100){let idCount={count:0},parsedView=parseStateMustaches(this._stringView,this._state),parsedNodes=parseHTML(parsedView)[0],parsingIsActive=!0,countIterations=0;for(;parsingIsActive&&countIterations<maxIterations;){let ifNodes=parsedNodes.querySelectorAll("if[expr]");for(let node of ifNodes){let condition=node.getAttribute("expr"),newNode=document.createElement("span");newNode.id=`if-${++idCount.count}`,!0===eval(condition)&&[...node.childNodes].forEach(e=>{newNode.appendChild(e)}),node.parentNode.replaceChild(newNode,node)}let forNodes=parsedNodes.querySelectorAll("for[var][from][to][step]");for(let node of forNodes){let newNode=document.createElement("span");newNode.id=`for-${++idCount.count}`;let loopVar=node.getAttribute("var"),loopFrom=eval(node.getAttribute("from")),loopTo=node.getAttribute("to"),loopStep=node.getAttribute("step"),loopExpression=`let ${loopVar}=${loopFrom}; \n        ${loopVar}<${loopTo}; \n        ${loopVar}+=${loopStep}`,evaluateInContext=new Function("node","newNode","parseLocalMustaches","loopVar","idCount",`for(${loopExpression}){\n          [...node.childNodes].forEach(childElem => {\n            if(childElem.nodeType != 1) \n              return;\n            let clonedNode = childElem.cloneNode(true);\n            newNode.appendChild(clonedNode);\n            clonedNode.outerHTML = parseLocalMustaches(\n              clonedNode.outerHTML, \n              [{key: loopVar, value: eval(loopVar)}]\n            );\n          });\n        }`).bind(this);evaluateInContext(node,newNode,parseLocalMustaches,loopVar,idCount),node.parentNode.replaceChild(newNode,node)}let foreachNodes=parsedNodes.querySelectorAll("foreach[elem][in]");for(let e of foreachNodes){let t=document.createElement("span");t.id=`foreach-${++idCount.count}`;let n=e.getAttribute("elem"),o=e.hasAttribute("idx")?e.getAttribute("idx"):"_",s=e.hasAttribute("arr")?e.getAttribute("arr"):"__",i=e.getAttribute("in"),a=new Function("node","newNode","parseLocalMustaches","idCount",`${i}.forEach((${n},${o},${s}) => {\n            [...node.childNodes].forEach(childElem => {\n              if(childElem.nodeType != 1) \n                return;\n              let clonedNode = childElem.cloneNode(true);\n              newNode.appendChild(clonedNode);\n              clonedNode.outerHTML = parseLocalMustaches(\n                clonedNode.outerHTML, [\n                  {key: '${n}', value: ${n}}\n                  ${"_"!==o?`,{key: '${o}', value: ${o}}`:""}\n                  ${"__"!==s?`,{key: '${s}', value: ${s}},`:""}\n                ]\n              );\n            });\n        });`).bind(this);a(e,t,parseLocalMustaches,idCount),e.parentNode.replaceChild(t,e)}countIterations>=maxIterations&&console.error(`Reached the defined maximum number of iterations [${maxIterations}].`),0===ifNodes.length&&0===forNodes.length&&0===foreachNodes.length&&(parsingIsActive=!1)}return parsedNodes}updateView(){let updatedNodes=this.parseView();if(null===this._activeNodes)this._activeNodes=updatedNodes,this._rootNode.appendChild(updatedNodes);else{let e=new diffDom({valueDiffing:!1}),t=this._rootNode.firstChild.childNodes,n=updatedNodes.childNodes;for(let o=0;o<t.length;++o){let s=e.diff(t[o],n[o]);e.apply(t[o],s)}this._activeNodes=updatedNodes}let eventNodes=this._rootNode.firstChild.querySelectorAll("*[on-event][call]");for(let node of eventNodes){let eventVar=node.getAttribute("on-event"),methodVar=node.getAttribute("call"),parsedArgs=[];if(node.hasAttribute("args")){let argsVar=node.getAttribute("args");if(argsVar.startsWith("(")&&(argsVar=argsVar.substr(1)),argsVar.endsWith(")")&&(argsVar=argsVar.substr(0,argsVar.length-1)),-1!==argsVar.indexOf(","))parsedArgs=argsVar.split(",").map(val=>eval(val));else{let evaluated=-1===argsVar.indexOf("{")?eval(argsVar):argsVar;void 0!==evaluated&&parsedArgs.push(evaluated)}}0!==eventVar.length&&this.methods().hasOwnProperty(methodVar)?node[eventVar]=this.methods()[methodVar].bind(this,...parsedArgs):0!==eventVar.length&&(node[eventVar]=this[methodVar].bind(this,...parsedArgs)),node.removeAttribute("on-event"),node.removeAttribute("call")}}};let parseHTML=function(e){var t=document.implementation.createHTMLDocument();return t.body.innerHTML=e,t.body.children},parseStateMustaches=function(e,t){let n=e;if(void 0===n)return"";for(let e in t)if(t.hasOwnProperty(e)){let o,s=new RegExp(`{{\\s*(${e})(|\\s+|.[^}]*)}}`);for(;o=n.match(s,t[e]);)if(/\S/.test(o[2])){let i=new Function("obj","return obj"+o[2]);n=n.replace(s,i(t[e]))}else n=n.replace(s,t[e])}return n},parseLocalMustaches=function(e,t){let n=e;return void 0===n?"":(t.forEach(e=>{let t,o=new RegExp(`{{\\s*(${e.key})(|\\s+|.[^}]*)}}`);for(;t=n.match(o,e.value);)if(/\S/.test(t[2])){let s=new Function("obj","return obj"+t[2]);n=n.replace(o,s(e.value))}else n=n.replace(o,e.value)}),n)}},{"diff-dom":1}]},{},[2])(2)});