<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>TinyTemplatesJs</title>
  <script src="tiny_helper.js"></script>
  <script src="tiny_state.js"></script>
  <script src="tiny_template-0.3.js"></script>
  <script>
    /* Example template. */
    class BaseTemplate extends TinyTemplate{
      constructor(parent, name, state){
        super(parent, name, state);
      }
      buy(product, price){
        this.setState({cartItems: this.getState('cartItems').concat({product: product, price: price})});
        calculateTotalPrice();
      }
      calculateTotalPrice(){
        let price = 0;
        this.getState('cartItems').forEach((product) => {
          price += product.price;
        });
        setState({priceTotal: price+'$'});
      }
    }
  </script>
</head>
<body>
  <!-- Application entry -->
  <h1>TinyTemplatesJS</h1>
  <fieldset>
    <legend><em>Example template</em></legend>
    <div id="app"></div>
  </fieldset>

  <!-- Example template -->
  <script type="text/html" id="base-template">
    <div class="base-template">
      <h2>Shopping</h2>   
      <fieldset class="buy">
        <h3>Buy</h3>
        <ul>
          <li>Apple 1$ <button onclick="baseTemplate.buy('Apple', 1)">+</button></li>
          <li>Banana 2$ <button onclick="baseTemplate.buy('Banana', 2)">+</button></li>
          <li>Orange 4$ <button onclick="baseTemplate.buy('Orange', 4)">+</button></li>
        </ul>
      </fieldset>
      <fieldset class="cart">
        <h3>Cart</h3>
        <p>
          :js(this.getState('cartItems').length > 0 
            ? this.getState('cartItems').map(e => e.product).join('<br>')
            : 'Empty')
        </p>
        <hr>
        Total => <span>:js(this.getState('priceTotal'))</span>
      </fieldset>
      <fieldset class="checkout">
        <h3>Checkout</h3>
        <form>
          <label>Payment method</label><br>
          <input type="radio" value="visa" name="pay" onchange="baseTemplate.setState({payment: 'visa'})" checked>Visa<br>
          <input type="radio" value="master" name="pay" onchange="baseTemplate.setState({payment: 'master'})">Mastercard<br>
          :if(this.getState('payment') === 'visa')
            <p>Enter visa credentials here:</p>
            <input type="text" placeholder="visa">
            <p>...</p>
          :fi
          :if(this.getState('payment') === 'master')
            <p>Enter master credentials here:</p>
            <input type="text" placeholder="master">
            <p>...</p>
          :fi
        </form>
      </fieldset>
    </div>
  </script>

  <!-- Parse -->
  <script>    
    let appNode = document.getElementById('app');
    let baseTemplate = new BaseTemplate(appNode, 'base-template', {cartItems: [], payment: 'visa', priceTotal: 0});
  </script>
</body>
</html>